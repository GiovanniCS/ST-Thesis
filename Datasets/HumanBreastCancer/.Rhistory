setwd("~/")
setwd("~/Desktop/ST-Thesis/Datasets/HumanBreastCancer")
library(Seurat)
library(SeuratData)
library(Cardinal)
breast <- Load10X_Spatial("./filtered_feature_bc_matrix/")
breast <- SCTransform(breast, assay = "Spatial", verbose = FALSE)
breast <- FindSpatiallyVariableFeatures(breast, assay = "SCT", features = VariableFeatures(brain)[1:1000],
selection.method = "markvariogram")
breast <- FindSpatiallyVariableFeatures(breast, assay = "SCT", features = VariableFeatures(breast)[1:1000],
selection.method = "markvariogram")
View(breast)
features = SpatiallyVariableFeatures(breast, selection.method = "markvariogram")
m = matrix(brain@assays$SCT@counts[features,],1000,3798)
m = matrix(breast@assays$SCT@counts[features,],1000,3798)
View(m)
coord <- GetTissueCoordinates(breast)
run <- factor(rep("run0", nrow(coord)))
s <- simulateSpectrum(n=1, peaks=10, from=100, to=150000)
mz = s$mz[1:1000]
fdata <- MassDataFrame(mz)
pdata <- PositionDataFrame(run=run, coord=coord)
out <- MSImagingExperiment(imageData=m,featureData=fdata,pixelData=pdata)
skm = spatialShrunkenCentroids(out,r=5,k=15,s=c(0),method="adaptive")
skm = spatialShrunkenCentroids(out,r=5,k=15,s=c(0),method="porco")
skm = spatialShrunkenCentroids(out,r=5,k=15,s=c(0))
set.seed(2020)
s <- simulateSpectrum(n=9, peaks=10, from=500, to=600)
coord <- expand.grid(x=1:3, y=1:3)
run <- factor(rep("run0", nrow(coord)))
fdata <- MassDataFrame(mz=s$mz)
pdata <- PositionDataFrame(run=run, coord=coord)
out2 <- MSImagingExperiment(imageData=s$intensity,
featureData=fdata,
pixelData=pdata)
out2 <- MSImagingExperiment(imageData=s$intensity,
featureData=fdata,
pixelData=pdata)
skm2 = spatialShrunkenCentroids(out2,r=5,k=15,s=c(0),method="adaptive")
skm2 = spatialShrunkenCentroids(out2,r=2,k=5,s=c(0),method="adaptive")
brain <- RunPCA(breast, assay = "SCT", verbose = FALSE)
breast <- RunPCA(breast, assay = "SCT", verbose = FALSE)
breast <- FindNeighbors(brain, reduction = "pca", dims = 1:30)
breast <- RunPCA(breast, assay = "SCT", verbose = FALSE)
breast <- Load10X_Spatial("./filtered_feature_bc_matrix/")
breast <- SCTransform(breast, assay = "Spatial", verbose = FALSE)
breast <- RunPCA(breast, assay = "SCT", verbose = FALSE)
breast <- FindNeighbors(breast, reduction = "pca", dims = 1:30)
breast <- FindClusters(breast, verbose = FALSE)
SpatialDimPlot(breast, label = TRUE, label.size = 3)
clusters = skm@resultData@listData[[1]][["class"]]
names(clusters) = names(breast@active.ident)
breast@active.ident <- clusters
SpatialDimPlot(breast, label = TRUE, label.size = 3)
skm2 = spatialShrunkenCentroids(out,r=2,k=5,s=c(0),method="adaptive")
m = matrix(brain@assays$SCT@counts,17668,2696)
coord <- GetTissueCoordinates(brain)
run <- factor(rep("run0", nrow(coord)))
s <- simulateSpectrum(n=1, peaks=10, from=100, to=150000)
mz = s$mz[1:17668]
fdata <- MassDataFrame(mz)
pdata <- PositionDataFrame(run=run, coord=coord)
out <- MSImagingExperiment(imageData=m,featureData=fdata,pixelData=pdata)
View(brain)
View(brain)
brain <- LoadData("stxBrain", type = "anterior1")
brain <- SCTransform(brain, assay = "Spatial", verbose = FALSE)
m = matrix(brain@assays$SCT@counts,17668,2696)
coord <- GetTissueCoordinates(brain)
run <- factor(rep("run0", nrow(coord)))
s <- simulateSpectrum(n=1, peaks=10, from=100, to=150000)
mz = s$mz[1:17668]
fdata <- MassDataFrame(mz)
pdata <- PositionDataFrame(run=run, coord=coord)
out <- MSImagingExperiment(imageData=m,featureData=fdata,pixelData=pdata)
ssc <- spatialShrunkenCentroids(out, r=2, k=14, s=c(0,3,6,9))
clusters = skm@resultData@listData[[4]][["class"]]
clusters = skm@resultData@listData[[3]][["class"]]
clusters = ssc@resultData@listData[[4]][["class"]]
names(clusters) = names(brean@active.ident)
names(clusters) = names(brain@active.ident)
brain@active.ident <- clusters
SpatialDimPlot(brain, label = TRUE, label.size = 3)
ssc <- spatialShrunkenCentroids(out, r=2, k=14, s=c(9),method="adaptive")
